{"version":3,"sources":["../../../src/client/components/use-reducer.ts"],"sourcesContent":["import type { Dispatch } from 'react'\nimport React, { use, useCallback } from 'react'\nimport { isThenable } from '../../shared/lib/is-thenable'\nimport type { AppRouterActionQueue } from '../../shared/lib/router/action-queue'\nimport type {\n  AppRouterState,\n  ReducerActions,\n  ReducerState,\n} from './router-reducer/router-reducer-types'\n\nexport function useUnwrapState(state: ReducerState): AppRouterState {\n  // reducer actions can be async, so sometimes we need to suspend until the state is resolved\n  if (isThenable(state)) {\n    const result = use(state)\n    return result\n  }\n\n  return state\n}\nexport function useReducer(\n  actionQueue: AppRouterActionQueue\n): [ReducerState, Dispatch<ReducerActions>] {\n  const [state, setState] = React.useState<ReducerState>(actionQueue.state)\n\n  const syncDevRenderIndicatorInDevelopment =\n    useSyncDevRenderIndicatorInDevelopment()\n\n  const dispatch = useCallback(\n    (action: ReducerActions) => {\n      syncDevRenderIndicatorInDevelopment(() =>\n        actionQueue.dispatch(action, setState)\n      )\n    },\n    [actionQueue, syncDevRenderIndicatorInDevelopment]\n  )\n\n  return [state, dispatch]\n}\n\nconst PASS_THROUGH = (fn: () => void) => fn()\n\nconst useSyncDevRenderIndicatorInDevelopment = () => {\n  if (process.env.NODE_ENV !== 'production') {\n    const useSyncDevRenderIndicator =\n      require('./react-dev-overlay/utils/dev-indicator/use-sync-dev-render-indicator')\n        .useSyncDevRenderIndicator as typeof import('./react-dev-overlay/utils/dev-indicator/use-sync-dev-render-indicator').useSyncDevRenderIndicator\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const syncDevRenderIndicator = useSyncDevRenderIndicator()\n    return syncDevRenderIndicator\n  } else {\n    return PASS_THROUGH\n  }\n}\n"],"names":["useReducer","useUnwrapState","state","isThenable","result","use","actionQueue","setState","React","useState","syncDevRenderIndicatorInDevelopment","useSyncDevRenderIndicatorInDevelopment","dispatch","useCallback","action","PASS_THROUGH","fn","process","env","NODE_ENV","useSyncDevRenderIndicator","require","syncDevRenderIndicator"],"mappings":";;;;;;;;;;;;;;;IAmBgBA,UAAU;eAAVA;;IATAC,cAAc;eAAdA;;;;iEATwB;4BACb;AAQpB,SAASA,eAAeC,KAAmB;IAChD,4FAA4F;IAC5F,IAAIC,IAAAA,sBAAU,EAACD,QAAQ;QACrB,MAAME,SAASC,IAAAA,UAAG,EAACH;QACnB,OAAOE;IACT;IAEA,OAAOF;AACT;AACO,SAASF,WACdM,WAAiC;IAEjC,MAAM,CAACJ,OAAOK,SAAS,GAAGC,cAAK,CAACC,QAAQ,CAAeH,YAAYJ,KAAK;IAExE,MAAMQ,sCACJC;IAEF,MAAMC,WAAWC,IAAAA,kBAAW,EAC1B,CAACC;QACCJ,oCAAoC,IAClCJ,YAAYM,QAAQ,CAACE,QAAQP;IAEjC,GACA;QAACD;QAAaI;KAAoC;IAGpD,OAAO;QAACR;QAAOU;KAAS;AAC1B;AAEA,MAAMG,eAAe,CAACC,KAAmBA;AAEzC,MAAML,yCAAyC;IAC7C,IAAIM,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;QACzC,MAAMC,4BACJC,QAAQ,yEACLD,yBAAyB;QAE9B,sDAAsD;QACtD,MAAME,yBAAyBF;QAC/B,OAAOE;IACT,OAAO;QACL,OAAOP;IACT;AACF"}